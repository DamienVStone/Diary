<style>
    .bt {
        border-top: 1px solid gray;
    }
    
    .bl {
        border-left: 1px solid gray;
    }
    
    .br {
        border-right: 1px solid gray;
    }
    
    .bb {
        border-bottom: 1px solid gray;
    }
    
    .deleteBtn {
        border: 1px solid black;
        border-radius: 30px;
        color: black;
        padding: 2vh;
        cursor: pointer;
        display: inline-block;
        vertical-align: top;
        margin: 1.5vh;
    }
    
    input {
        width: 100%;
    }
</style>
<label for="filter">Поиск</label>
<input type="text" id="filter" onkeyup="getList(this.value)" />
<div id="content">Загрузка...</div>
<script type="text/javascript">
    var entryTemplate = "<hr/><div style='display: inline-block; width: 85%'><div><div><input type='text' id='tags-{{id}}' value='{{tags}}'/></div><div><input type='text' id='value-{{id}}' value='{{value}}' /></div></div><input type='button' onclick='save({{id}})' value='Сохранить'></div><div class='deleteBtn' onclick='remove({{id}})'> X </div>";
    var newEntryTemplate = "<hr/><div style='display: inline-block; width: 85%'><div><div><input type='text' id='tags'/></div><div><input type='text' id='value'/></div></div><input type='button' onclick='add()' value='Добавить'></div>";

    function getList(filter) {
        var content = document.getElementById("content");
        GET("/List?filter=" + filter,
            function(r) {
                content.innerHTML = "";
                for (let i = 0; i < r.length; i++) {
                    const entry = r[i];
                    content.innerHTML +=
                        entryTemplate
                        .replace("{{tags}}", entry.Tags)
                        .replace("{{value}}", entry.Value)
                        .replace(/\{\{id\}\}/g, entry.Id);
                }

                content.innerHTML += newEntryTemplate;
            }
        );
    }

    function GET(url, callback) {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', url);
        xhr.onload = function() {
            if (xhr.status === 200) {
                callback(JSON.parse(xhr.responseText))
            } else {
                alert('Ошибка: ' + xhr.status);
            }
        };

        xhr.send();
    }

    function add() {
        var xhr = new XMLHttpRequest();
        var tags = document.getElementById("tags").value;
        var v = document.getElementById("value").value;
        xhr.open('PUT', '/New');
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        xhr.onload = function() {
            if (xhr.status === 200) {
                getList('');
            } else if (xhr.status !== 200) {
                alert('Ошибка: ' + xhr.status);
            }
        };

        xhr.send(encodeURI('Tags=' + tags + '&Value=' + v));
    }

    function save(id) {
        if (!confirm("Сохранить?")) return;
        var xhr = new XMLHttpRequest();
        var tags = document.getElementById("tags-" + id).value;
        var v = document.getElementById("value-" + id).value;
        xhr.open('POST', '/Edit/' + id);
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        xhr.onload = function() {
            if (xhr.status === 200) {
                getList('');
            } else if (xhr.status !== 200) {
                alert('Ошибка: ' + xhr.status);
            }
        };

        xhr.send(encodeURI('Tags=' + tags + '&Value=' + v));
    }

    function remove(id) {
        if (!confirm("Удалить?")) return;
        var xhr = new XMLHttpRequest();
        var tags = document.getElementById("tags").value;
        var v = document.getElementById("value").value;
        xhr.open('DELETE', '/Delete/' + id);
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        xhr.onload = function() {
            if (xhr.status === 200) {
                getList('');
            } else if (xhr.status !== 200) {
                alert('Ошибка: ' + xhr.status);
            }
        };

        xhr.send();
    }

    getList('');
</script>